# 리눅스 커널 프로그래밍

##### [1] 사용자 공간과 커널 공간

운영체제라 불리는 것은 여러가지 프로그램을 수행할 수 있는 기능을 제공하는 것을 말한다.

- 8051 프로세서는 롬의 0번지부터 차례대로 기계어를 읽어가며 프로그램을 수행한다.

  다른 프로그램을 수행하고 싶다면 다른 프로그램을 롬에 써야한다.

- 운영 체제는 여러 프로그램을 실행할 수 있게 해주는 관리체제를 제공

  최소 2개 이상의 프로그램이 메모리에 존재

메모리에서 운영체제와 사용자 프로그램이 조화롭게 공존할 수 있는 방법

- 메모리 영역을 사용자 공간과 커널 공간으로 나눔
- 리눅스의 경우 i386 32비트 환경에서 사용자 영역을 3G, 커널 영역을 1G로 나누어 사용

CPU 아키텍처와 32비트, 64비트에 따라서 사용자 공간과 커널 공간의 크기가 다르다.

하드웨어에 종속적인 부분이기 때문에 CPU마다 다르게 구현되어 있다.

- `include/asm-i386/page.h`에 `__PAGE_OFFSET`이나 `PAGE_OFFSET`에서 커널 공간과 사용자 공간의 경계값(0xC000 000)을 알 수 잇다.
- 윈도우 NT 환경에서는 사용자 공간 2G와 커널 공간 2G를 사용하는 것처럼 이 영역의 크기는 커널 설계자가 의동한 설계에 따라 다르다.

<br/>

---

##### [2] 메모리 공간에 접근할 수 있는 권한 부여

- 리눅스에서 다른 사용자가 만든 파일을 읽을 수 없게 하는 것처럼 커널 공간과 사용자 공간에도 권한을 부여하고, 해당 권한이 있을 때만 메모리 접근을 허용
- 메모리에 접근할 때마다 권한이 있는지 여부를 검사한다면 프로그램 실행보다 검사하는데 더 많은 시간이 걸릴 수도 있기 때문에 CPU 자체에서 제공

CPU에서 제공공하는 권한을 특권 링(Privilege Ring) 또는 특권 레벨(Privilege Level)이라고 함

![image-20201012135512770](Notebook.assets/image-20201012135512770.png)

- 특권 레벨은 0~3까지 4가지 레벨을 제공
  - Level 0 : 커널 공간 (Core)
  - Level 1, 2 : 커널 공간 (Subsystem)
  - Level 3 : 사용자 공간
- 보통 운영체제는 0과 3번 두 가지 영역만 사용

